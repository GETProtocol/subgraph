enum Interaction {
  NEW_EVENT
  MINT
  SCAN
  CLAIM
  INVALIDATE
}

enum TicketState {
  UNSCANNED
  SCANNED
  CLAIMABLE
  INVALIDATED
}

type Protocol @entity {
  id: ID!
  getUsed: BigInt!
  averageGetUsedPerMint: BigDecimal!
  mintCount: BigInt!
  invalidateCount: BigInt!
  scanCount: BigInt!
  claimCount: BigInt!
}

type ProtocolDay @entity {
  id: ID!
  day: Int!
  getUsed: BigInt!
  averageGetUsedPerMint: BigDecimal!
  mintCount: BigInt!
  invalidateCount: BigInt!
  scanCount: BigInt!
  claimCount: BigInt!
}

type Event @entity {
  id: ID!
  relayer: Relayer!
  usageEvents: [UsageEvent!]! @derivedFrom(field: "event")
  getUsed: BigInt!
  eventName: String!
  shopUrl: String!
  imageUrl: String!
  orderTime: BigInt!
  latitude: BigDecimal!
  longitude: BigDecimal!
}

type Relayer @entity {
  id: ID!
  getUsed: BigInt!
  averageGetUsedPerMint: BigDecimal!
  mintCount: BigInt!
  invalidateCount: BigInt!
  scanCount: BigInt!
  claimCount: BigInt!
  events: [Event!]! @derivedFrom(field: "relayer")
  relayerDays: [RelayerDay!]! @derivedFrom(field: "relayer")
  usageEvents: [UsageEvent!]! @derivedFrom(field: "relayer")
}

type RelayerDay @entity {
  id: ID! # Composite PK: relayerAddress-timestampAsDay
  relayer: Relayer!
  day: Int!
  getUsed: BigInt!
  averageGetUsedPerMint: BigDecimal!
  mintCount: BigInt!
  invalidateCount: BigInt!
  scanCount: BigInt!
  claimCount: BigInt!
}

type Ticket @entity {
  id: ID!
  relayer: Relayer!
  event: Event!
  state: TicketState!
  url: String
  fuelTankBalance: BigInt!
}

type UsageEvent @entity {
  id: ID!
  relayer: Relayer!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  orderTime: BigInt!
  day: Int!
  getUsed: BigInt!
  interaction: Interaction!
  event: Event!
  nftIndex: BigInt!
  latitude: BigDecimal!
  longitude: BigDecimal!
}
